<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Enviar Correo con Resend</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 50px auto; }
        form { display: flex; flex-direction: column; gap: 15px; }
        input, textarea, button { padding: 10px; }
    </style>
</head>
<body>
    <h2>Contacto y Adjunto</h2>
    <form id="emailForm">
        <input type="text" id="nombre" placeholder="Tu nombre" required>
        <textarea id="mensaje" placeholder="Tu mensaje" required></textarea>
        <input type="file" id="archivo" required>
        <button type="submit" id="btnEnviar">Enviar Correo</button>
    </form>

    <script>
        // Función para convertir archivo a Base64
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]); // Solo la data
            reader.onerror = error => reject(error);
        });

        document.getElementById('emailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.innerText = "Enviando...";

            const nombre = document.getElementById('nombre').value;
            const mensaje = document.getElementById('mensaje').value;
            const file = document.getElementById('archivo').files[0];

            try {
                const base64Content = await toBase64(file);
//                const response = await fetch('https://tu-app-en-render.onrender.com/send-email', {
                const response = await fetch('http://localhost:3000/send-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nombre,
                        mensaje,
                        fileName: file.name,
                        fileContent: base64Content
                    })
                });

                if (response.ok) alert('¡Correo enviado con éxito!');
                else alert('Error al enviar.');
            } catch (err) {
                console.error(err);
                alert('Hubo un error en el proceso.');
            } finally {
                btn.disabled = false;
                btn.innerText = "Enviar Correo";
            }
        });
    </script>
</body>
</html>